!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.beadnet=e()}(this,function(){"use strict";var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t,r=(function(t){var e,n;e=o,n=function(){var r=function(){},l="undefined",c=["trace","debug","info","warn","error"];function i(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function h(t,e){for(var n=0;n<c.length;n++){var o=c[n];this[o]=n<t?r:this.methodFactory(o,t,e)}this.log=this.debug}function d(t,e,n){return"debug"===(o=t)&&(o="log"),typeof console!==l&&(void 0!==console[o]?i(console,o):void 0!==console.log?i(console,"log"):r)||function(t,e,n){return function(){typeof console!==l&&(h.call(this,e,n),this[t].apply(this,arguments))}}.apply(this,arguments);var o}function n(n,t,e){var o,r=this,i="loglevel";function a(){var t;if(typeof window!==l){try{t=window.localStorage[i]}catch(t){}if(typeof t===l)try{var e=window.document.cookie,n=e.indexOf(encodeURIComponent(i)+"=");-1!==n&&(t=/^([^;]+)/.exec(e.slice(n))[1])}catch(t){}return void 0===r.levels[t]&&(t=void 0),t}}n&&(i+=":"+n),r.name=n,r.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},r.methodFactory=e||d,r.getLevel=function(){return o},r.setLevel=function(t,e){if("string"==typeof t&&void 0!==r.levels[t.toUpperCase()]&&(t=r.levels[t.toUpperCase()]),!("number"==typeof t&&0<=t&&t<=r.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(o=t,!1!==e&&function(t){var e=(c[t]||"silent").toUpperCase();if(typeof window!==l){try{return window.localStorage[i]=e}catch(t){}try{window.document.cookie=encodeURIComponent(i)+"="+e+";"}catch(t){}}}(t),h.call(r,t,n),typeof console===l&&t<r.levels.SILENT)return"No console available for logging"},r.setDefaultLevel=function(t){a()||r.setLevel(t,!1)},r.enableAll=function(t){r.setLevel(r.levels.TRACE,t)},r.disableAll=function(t){r.setLevel(r.levels.SILENT,t)};var s=a();null==s&&(s=null==t?"WARN":t),r.setLevel(s,!1)}var o=new n,a={};o.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=a[t];return e||(e=a[t]=new n(t,o.getLevel(),o.methodFactory)),e};var t=typeof window!==l?window.log:void 0;return o.noConflict=function(){return typeof window!==l&&window.log===o&&(window.log=t),o},o.getLoggers=function(){return a},o},t.exports?t.exports=n():e.log=n()}(t={exports:{}},t.exports),t.exports);r.enableAll(),r.setLevel("TRACE");var i={colorScheme:d3.scaleOrdinal(d3.schemeCategory10),container:{selector:"#beadnet",backgroundColor:"#FFF"},nodes:{radius:30,color:null,strokeWidth:3,strokeColor:null},channels:{color:"lightgray",strokeWidth:3,strokeColor:null}};var e=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}();return function(){function o(t){var e,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this._opt=(e=t,n={},Object.assign(n,i,e),n.nodes.color=n.nodes.color||n.colorScheme(0),n.nodes.strokeColor=n.nodes.strokeColor||n.container.backgroundColor,n),r.debug("initializing beadnet with options: ",this._opt)}return e(o,[{key:"createSVG",value:function(){this.container=document.querySelector(this._opt.container.selector),this.svg=d3.select(this.container).append("svg").attr("class","beadnet"),this.updateSVGSize(),this.chart=this.svg.append("g").attr("class","chart").attr("transform","translate(0,0) scale(1)"),this.channelContainer=this.chart.append("g").attr("class","channels"),this.nodeContainer=this.chart.append("g").attr("class","nodes"),this.nodes=[],this.channels=[],this.simulation=this.createSimulation(),this.updateSimulationCenter(),this.behaviors=this.createBehaviors(),this.svg.call(this.behaviors.zoom),this.createNodes(),window.addEventListener("resize",this.onResize.bind(this))}},{key:"createSimulation",value:function(){return d3.forceSimulation().alphaDecay(.1).force("charge",d3.forceManyBody().strength(-1e3).distanceMin(this.forceDistance).distanceMax(3*this.forceDistance)).force("collide",d3.forceCollide(this.forceDistance/6)).force("link",d3.forceLink(this.channels).distance(this.forceDistance)).force("center",d3.forceCenter(this.width/2,this.height/2)).alphaTarget(0).on("tick",this.ticked.bind(this))}},{key:"updateSVGSize",value:function(){this.width=+this.container.clientWidth,this.height=+this.container.clientHeight,this.forceDistance=.1*(this.width+this.height),this.svg.attr("width",this.width).attr("height",this.height)}},{key:"onResize",value:function(){this.updateSVGSize(),this.updateSimulationCenter(),this.createBehaviors()}},{key:"createBehaviors",value:function(){var t=this;return{zoom:d3.zoom().scaleExtent([.1,5,4]).on("zoom",function(){return t.chart.attr("transform",d3.event.transform)}),drag:d3.drag().on("start",this.onDragStart.bind(this)).on("drag",this.onDragged.bind(this)).on("end",this.onDragendEnd.bind(this))}}},{key:"updateSimulationCenter",value:function(){var t=this.svg.attr("width")/2,e=this.svg.attr("height")/2;this.simulation.force("center",d3.forceCenter(t,e)).restart()}},{key:"createNodes",value:function(){this.nodeElements=this.nodeContainer.selectAll(".node").data(this.nodes).enter().append("g").attr("id",function(t){return console.log(t),t.id}).attr("class","node").attr("balance",function(t){return t.balance}).style("stroke",this._opt.nodes.strokeColor).style("stroke-width",this._opt.nodes.strokeWidth);this.nodeElements.append("circle").attr("class","node").attr("r",this._opt.nodes.radius).attr("fill",function(t){return t.color}).style("cursor","pointer"),this.nodeElements.append("text").style("stroke-width",.5).attr("stroke",this._opt.nodes.strokeColor).attr("fill",this._opt.nodes.strokeColor).attr("font-family","sans-serif").attr("font-size","15px").attr("y","5px").attr("text-anchor","middle").attr("pointer-events","none").text(function(t){return t.balance||t.id});return this.nodeElements.append("title").text(function(t){return t.id}),this.nodeElements.call(this.behaviors.drag),this.nodeElements}},{key:"addNode",value:function(t){t.channelCount=0,t.color=t.color||this._opt.colorScheme(this.nodes.length%10),this.nodes.push(t),this.createNodes(),this.simulation.nodes(this.nodes).restart()}},{key:"addNodes",value:function(t){var e,n=this;t=t.map(function(t,e){return t.channelCount=0,t.color=t.color||n._opt.colorScheme(e%10),t}),(e=this.nodes).push.apply(e,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(t)),this.createNodes(),this.simulation.nodes(this.nodes).restart()}},{key:"updateChannels",value:function(){this.channelElements=this.channelContainer.selectAll(".channel").data(this.channels),this.channelElements.enter().append("g").attr("class","channel").attr("source-balance",function(t){return t.sourceBalance}).attr("target-balance",function(t){return t.targetBalance}).attr("source-id",function(t){return t.source.id}).attr("target-id",function(t){return t.target.id}).append("path").style("stroke-width",this._opt.channels.strokeWidth).style("stroke",this._opt.channels.color).style("fill","none"),this.paths=this.channelContainer.selectAll(".channel path"),this.channelElements.exit().remove()}},{key:"addChannel",value:function(t){var e=d3.map(this.nodes,function(t){return t.id}),n=e.get(t.source),o=e.get(t.target);this.channels.push({source:n,target:o,sourceBalance:t.sourceBalance,targetBalance:t.targetBalance}),n.channelCount=n.channelCount+1,o.channelCount=o.channelCount+1,console.log("addChannel: ",n),this.updateChannels(),this.simulation.force("link").links(this.channels),this.simulation.alpha(1).restart()}},{key:"addChannels",value:function(t){var e=this;t.forEach(function(t){return e.addChannel(t)})}},{key:"getRandomNode",value:function(){return this.nodes[Math.floor(Math.random()*this.nodes.length)]}},{key:"ticked",value:function(){this.nodeElements&&this.nodeElements.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),this.paths&&this.paths.attr("d",function(t){return"M"+t.source.x+","+t.source.y+" "+t.target.x+","+t.target.y})}},{key:"onDragStart",value:function(t){d3.event.active||this.simulation.alphaTarget(.1).restart(),t.fx=t.x,t.fy=t.y}},{key:"onDragged",value:function(t){t.fx=d3.event.x,t.fy=d3.event.y}},{key:"onDragendEnd",value:function(t){d3.event.active||this.simulation.alphaTarget(0),t.fx=null,t.fy=null}}]),o}()});
//# sourceMappingURL=beadnet.standalone.min.js.map
